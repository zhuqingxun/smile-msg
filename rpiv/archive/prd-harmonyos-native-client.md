---
description: "äº§å“éœ€æ±‚æ–‡æ¡£: SmileMsg HarmonyOS NEXT åŸç”Ÿå®¢æˆ·ç«¯"
status: archived
created_at: 2026-01-31T22:00:00
updated_at: 2026-01-31T23:55:00
archived_at: 2026-01-31T23:55:00
---

# SmileMsg HarmonyOS NEXT åŸç”Ÿå®¢æˆ·ç«¯ PRD

## 1. æ‰§è¡Œæ‘˜è¦

SmileMsg æ˜¯ä¸€æ¬¾"é˜…åå³ç„š"å³æ—¶é€šè®¯å·¥å…·ï¼Œå½“å‰å·²æœ‰ Webã€Desktopï¼ˆElectronï¼‰å’Œ Androidï¼ˆCapacitorï¼‰ä¸‰ä¸ªå®¢æˆ·ç«¯ç‰ˆæœ¬ã€‚Android ç‰ˆåŸºäº Capacitor WebView æ¶æ„ï¼Œåœ¨åä¸ºè®¾å¤‡ä¸Šé¢ä¸´ä¸¥é‡çš„åå°ä¿æ´»é—®é¢˜â€”â€”ç³»ç»Ÿé¢‘ç¹å›æ”¶ WebView è¿›ç¨‹ï¼Œå¯¼è‡´ Socket è¿æ¥æ–­å¼€ã€æ¶ˆæ¯æ— æ³•åŠæ—¶é€è¾¾ã€‚

æœ¬ PRD å®šä¹‰ SmileMsg çš„ HarmonyOS NEXT åŸç”Ÿå®¢æˆ·ç«¯ï¼Œä½¿ç”¨ ArkTS + ArkUI ä»é›¶å¼€å‘ï¼ŒåŠŸèƒ½ä¸ Android ç‰ˆ 1:1 å¯¹é½ã€‚æ ¸å¿ƒä»·å€¼åœ¨äºåˆ©ç”¨é¸¿è’™ç³»ç»Ÿçº§çš„ Push Kit æ¨é€æœåŠ¡ï¼Œå½»åº•è§£å†³ä¿æ´»å’Œæ¶ˆæ¯é€è¾¾é—®é¢˜ï¼Œæ— éœ€ä¾èµ–å‰å°æœåŠ¡æˆ–å¿ƒè·³ä¿æ´»ç­‰ workaroundã€‚

MVP ç›®æ ‡ï¼šäº¤ä»˜ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„é¸¿è’™åŸç”Ÿå®¢æˆ·ç«¯ï¼Œè¦†ç›–ç™»å½•ã€ç§èŠã€æ¨é€é€šçŸ¥ã€æ–­çº¿é‡è¿ç­‰å…¨éƒ¨æ ¸å¿ƒåŠŸèƒ½ï¼Œå¹¶é€šè¿‡ AppGallery ä¸Šæ¶åˆ†å‘ã€‚åŒæ—¶å®ŒæˆæœåŠ¡ç«¯çš„ Push Kit æ¨é€é€šé“é›†æˆã€‚

## 2. ä½¿å‘½

**ä½¿å‘½å£°æ˜**ï¼šä¸º HarmonyOS NEXT ç”¨æˆ·æä¾›åŸç”Ÿä½“éªŒçš„é˜…åå³ç„šå³æ—¶é€šè®¯æœåŠ¡ï¼Œç¡®ä¿æ¶ˆæ¯åœ¨ä»»ä½•åº”ç”¨çŠ¶æ€ä¸‹éƒ½èƒ½å¯é é€è¾¾ã€‚

**æ ¸å¿ƒåŸåˆ™**ï¼š

1. **åŸç”Ÿä½“éªŒä¼˜å…ˆ**ï¼šéµå¾ª HarmonyOS Design è§„èŒƒï¼Œä½¿ç”¨ ArkUI æ„å»ºç•Œé¢ï¼Œè€Œéè·¨å¹³å°æ–¹æ¡ˆçš„å¦¥åäº§ç‰©
2. **æ¨é€å¯é æ€§**ï¼šå®Œå…¨ä¾èµ–ç³»ç»Ÿçº§ Push Kit æ¨é€ï¼Œä¸åšåå°å¸¸é©»ï¼Œä¸å¯¹æŠ—ç³»ç»Ÿè¡Œä¸º
3. **åŠŸèƒ½å¯¹ç­‰**ï¼šä¸ Android ç‰ˆåŠŸèƒ½ 1:1 å¯¹é½ï¼Œç”¨æˆ·ä» Android åˆ‡æ¢åˆ°é¸¿è’™è®¾å¤‡æ—¶æ— å­¦ä¹ æˆæœ¬
4. **æœ€å°ä¾µå…¥**ï¼šæœåŠ¡ç«¯æ”¹åŠ¨é™å®šåœ¨æ¨é€é€šé“æ‰©å±•ï¼Œä¸æ”¹å˜ç°æœ‰ä¸šåŠ¡é€»è¾‘å’Œæ•°æ®ç»“æ„

## 3. ç›®æ ‡ç”¨æˆ·

### ä¸»è¦ç”¨æˆ·è§’è‰²

- **HarmonyOS NEXT è®¾å¤‡ç”¨æˆ·**ï¼šä½¿ç”¨çº¯é¸¿è’™è®¾å¤‡ï¼ˆéå…¼å®¹å®‰å“çš„æ—§é¸¿è’™ç³»ç»Ÿï¼‰çš„ç”¨æˆ·
- å·²æœ‰ SmileMsg ä½¿ç”¨ä¹ æƒ¯ï¼Œæˆ–ç”±å…¶ä»–å¹³å°ç”¨æˆ·é‚€è¯·åŠ å…¥

### æŠ€æœ¯èˆ’é€‚åº¦

- æ™®é€šæ‰‹æœºç”¨æˆ·ï¼Œæ— éœ€æŠ€æœ¯èƒŒæ™¯
- èƒ½å®Œæˆ AppGallery ä¸‹è½½å®‰è£…ã€æˆäºˆé€šçŸ¥æƒé™ç­‰åŸºæœ¬æ“ä½œ

### å…³é”®ç”¨æˆ·éœ€æ±‚å’Œç—›ç‚¹

| éœ€æ±‚/ç—›ç‚¹ | æè¿° |
|-----------|------|
| æ¶ˆæ¯å³æ—¶é€è¾¾ | å³ä½¿åº”ç”¨åœ¨åå°æˆ–è¢«ç³»ç»Ÿå›æ”¶ï¼Œä¹Ÿèƒ½é€šè¿‡æ¨é€é€šçŸ¥æ”¶åˆ°æ¶ˆæ¯ |
| åŸç”Ÿä½“éªŒ | ç¬¦åˆé¸¿è’™ç³»ç»Ÿçš„è§†è§‰å’Œäº¤äº’è§„èŒƒï¼Œä¸åƒ WebView å¥—å£³åº”ç”¨ |
| éšç§å®‰å…¨ | é˜…åå³ç„šï¼ŒæœåŠ¡ç«¯æ— æŒä¹…åŒ–å­˜å‚¨ï¼Œæ¶ˆæ¯ä¸è½ç›˜ |
| ç®€å•æ˜“ç”¨ | æ— éœ€æ³¨å†Œè´¦å·ï¼Œæ˜µç§°å³å¯ä½¿ç”¨ |

## 4. MVP èŒƒå›´

### èŒƒå›´å†…

**æ ¸å¿ƒåŠŸèƒ½**
- âœ… æ˜µç§°ç™»å½•ï¼ˆUUID + æ˜µç§°ï¼Œå®¢æˆ·ç«¯ç”Ÿæˆ UUIDï¼‰
- âœ… ä¸€å¯¹ä¸€ç§èŠï¼ˆå‘èµ·ã€æ¥å—ã€æ¶ˆæ¯æ”¶å‘ã€ç¦»å¼€ä¼šè¯ï¼‰
- âœ… é˜…åå³ç„šï¼ˆæ¶ˆæ¯ä»…åœ¨å†…å­˜ä¸­ï¼Œä¸æŒä¹…åŒ–ï¼‰
- âœ… ç³»ç»Ÿæ¶ˆæ¯æ˜¾ç¤ºï¼ˆå¯¹æ–¹ç¦»çº¿æç¤ºç­‰ï¼‰

**æ¨é€ä¸é€šçŸ¥**
- âœ… åä¸º Push Kit Token è·å–ä¸ä¸ŠæŠ¥
- âœ… åå°/é”å±æ¨é€é€šçŸ¥æ¥æ”¶
- âœ… é€šçŸ¥ç‚¹å‡»æ‰“å¼€åº”ç”¨
- âœ… å‰å°æŒ¯åŠ¨åé¦ˆ

**è¿æ¥ä¸æ¢å¤**
- âœ… è‡ªåŠ¨æ–­çº¿é‡è¿ï¼ˆæŒ‡æ•°é€€é¿ï¼‰
- âœ… é‡è¿åè‡ªåŠ¨é‡æ–°ç™»å½•
- âœ… ä¼šè¯æ¢å¤ï¼ˆæœåŠ¡ç«¯ 30 åˆ†é’Ÿå®½é™æœŸå†…ï¼‰
- âœ… ç¦»çº¿æ¶ˆæ¯è¡¥å‘
- âœ… æœ¬åœ°æŒä¹…åŒ– UUID + æ˜µç§°ï¼Œå¯åŠ¨æ—¶è‡ªåŠ¨æ¢å¤ä¼šè¯

**ç”Ÿå‘½å‘¨æœŸç®¡ç†**
- âœ… å‰åå°åˆ‡æ¢æ„ŸçŸ¥ä¸çŠ¶æ€ä¸ŠæŠ¥ï¼ˆ`app_state` äº‹ä»¶ï¼‰
- âœ… è¿”å›æ‰‹åŠ¿è¡Œä¸ºå®šä¹‰ï¼ˆchatâ†’ç¦»å¼€ä¼šè¯ï¼Œidleâ†’æ–­å¼€ï¼Œloginâ†’é€€å‡ºï¼‰

**æœåŠ¡ç«¯æ”¹åŠ¨**
- âœ… åä¸º Push Kit æœåŠ¡ç«¯æ¨é€é€šé“é›†æˆï¼ˆOAuth 2.0 + REST APIï¼‰
- âœ… å¹³å°è¯†åˆ«æ–°å¢ `harmony` ç±»å‹
- âœ… Push token æŒ‰ `platform` å­—æ®µè·¯ç”±è‡³ FCM æˆ– Push Kit

**åˆ†å‘**
- âœ… AppGallery ä¸Šæ¶

### èŒƒå›´å¤–

- âŒ å¤šç«¯ååŒï¼ˆæ‰‹æœº/å¹³æ¿/æ‰‹è¡¨æµè½¬ï¼‰
- âŒ é¸¿è’™å¡ç‰‡æœåŠ¡ï¼ˆWidgetï¼‰
- âŒ åˆ†äº«åŠŸèƒ½ï¼ˆç³»ç»Ÿåˆ†äº«é¢æ¿é›†æˆï¼‰
- âŒ åå° Socket ä¿æ´»ï¼ˆä¸åšåå°å¸¸é©»ï¼Œçº¯é  Push Kitï¼‰
- âŒ å‰å°æœåŠ¡ï¼ˆæ— éœ€ï¼Œé¸¿è’™ç‰ˆä¸åšä¿æ´»ï¼‰
- âŒ GMS æ£€æµ‹ä¸é™çº§é€»è¾‘ï¼ˆé¸¿è’™è®¾å¤‡å‡æœ‰åä¸ºæœåŠ¡ï¼‰
- âŒ ç¾¤èŠåŠŸèƒ½
- âŒ å¤šåª’ä½“æ¶ˆæ¯ï¼ˆå›¾ç‰‡ã€è¯­éŸ³ç­‰ï¼‰
- âŒ ç«¯åˆ°ç«¯åŠ å¯†

## 5. ç”¨æˆ·æ•…äº‹

### æ ¸å¿ƒç”¨æˆ·æ•…äº‹

**US-1ï¼šé¦–æ¬¡ç™»å½•**
> ä½œä¸ºä¸€ä¸ª HarmonyOS NEXT ç”¨æˆ·ï¼Œæˆ‘æƒ³è¦é€šè¿‡è¾“å…¥æ˜µç§°å¿«é€Ÿç™»å½• SmileMsgï¼Œä»¥ä¾¿æ— éœ€å¤æ‚çš„æ³¨å†Œæµç¨‹å°±èƒ½å¼€å§‹ä½¿ç”¨ã€‚

ç¤ºä¾‹ï¼šç”¨æˆ·æ‰“å¼€ App â†’ è¾“å…¥æ˜µç§°"å°æ˜" â†’ ç‚¹å‡»ç™»å½• â†’ è¿›å…¥ç©ºé—²çŠ¶æ€ï¼Œæ˜¾ç¤ºè¾“å…¥å¯¹æ–¹æ˜µç§°çš„ç•Œé¢ã€‚

**US-2ï¼šå‘èµ·ç§èŠ**
> ä½œä¸ºä¸€ä¸ªå·²ç™»å½•ç”¨æˆ·ï¼Œæˆ‘æƒ³è¦è¾“å…¥å¯¹æ–¹æ˜µç§°å‘èµ·ä¸€å¯¹ä¸€èŠå¤©ï¼Œä»¥ä¾¿ä¸æœ‹å‹å³æ—¶äº¤æµã€‚

ç¤ºä¾‹ï¼šåœ¨ç©ºé—²é¡µé¢è¾“å…¥å¯¹æ–¹æ˜µç§°"å°çº¢" â†’ ç‚¹å‡»è¿æ¥ â†’ åŒæ–¹è¿›å…¥èŠå¤©ç•Œé¢ã€‚

**US-3ï¼šæ¥æ”¶èŠå¤©é‚€è¯·**
> ä½œä¸ºä¸€ä¸ªå·²ç™»å½•ç”¨æˆ·ï¼Œå½“åˆ«äººå‘æˆ‘å‘èµ·èŠå¤©æ—¶ï¼Œæˆ‘å¸Œæœ›è‡ªåŠ¨è¿›å…¥èŠå¤©ç•Œé¢ï¼Œä»¥ä¾¿ç«‹å³å¼€å§‹å¯¹è¯ã€‚

ç¤ºä¾‹ï¼šæ­£åœ¨ç©ºé—²é¡µé¢ç­‰å¾… â†’ æ”¶åˆ°"å°æ˜"çš„èŠå¤©è¯·æ±‚ â†’ è‡ªåŠ¨åˆ‡æ¢åˆ°èŠå¤©ç•Œé¢ â†’ æŒ¯åŠ¨æç¤ºã€‚

**US-4ï¼šåå°æ”¶æ¶ˆæ¯**
> ä½œä¸ºä¸€ä¸ªæ­£åœ¨èŠå¤©çš„ç”¨æˆ·ï¼Œå½“æˆ‘åˆ‡æ¢åˆ°å…¶ä»– App åï¼Œæˆ‘å¸Œæœ›é€šè¿‡ç³»ç»Ÿæ¨é€é€šçŸ¥æ”¶åˆ°æ–°æ¶ˆæ¯ï¼Œä»¥ä¾¿ä¸é”™è¿‡é‡è¦ä¿¡æ¯ã€‚

ç¤ºä¾‹ï¼šæ­£åœ¨èŠå¤© â†’ åˆ‡æ¢åˆ°å¾®ä¿¡ â†’ æ”¶åˆ°ç³»ç»Ÿæ¨é€"å°çº¢ å‘æ¥æ¶ˆæ¯ï¼šä½ å¥½" â†’ ç‚¹å‡»é€šçŸ¥ â†’ å›åˆ° SmileMsg èŠå¤©ç•Œé¢ã€‚

**US-5ï¼šæ–­çº¿æ¢å¤**
> ä½œä¸ºä¸€ä¸ªæ­£åœ¨èŠå¤©çš„ç”¨æˆ·ï¼Œå½“ç½‘ç»œçŸ­æš‚ä¸­æ–­åæ¢å¤æ—¶ï¼Œæˆ‘å¸Œæœ›è‡ªåŠ¨é‡æ–°è¿æ¥å¹¶æ¢å¤ä¹‹å‰çš„ä¼šè¯ï¼Œä»¥ä¾¿ç»§ç»­èŠå¤©ã€‚

ç¤ºä¾‹ï¼šåœ°é“è¿›éš§é“ç½‘ç»œæ–­å¼€ â†’ å‡ºéš§é“ç½‘ç»œæ¢å¤ â†’ è‡ªåŠ¨é‡è¿ â†’ ä¼šè¯æ¢å¤ â†’ æ”¶åˆ°å¯¹æ–¹åœ¨æ–­çº¿æœŸé—´å‘çš„æ¶ˆæ¯ã€‚

**US-6ï¼šä¼šè¯è‡ªåŠ¨æ¢å¤**
> ä½œä¸ºä¸€ä¸ªä¹‹å‰ç™»å½•è¿‡çš„ç”¨æˆ·ï¼Œå½“æˆ‘é‡æ–°æ‰“å¼€ App æ—¶ï¼Œæˆ‘å¸Œæœ›è‡ªåŠ¨æ¢å¤ä¹‹å‰çš„ç™»å½•çŠ¶æ€ï¼Œä»¥ä¾¿æ— éœ€é‡æ–°è¾“å…¥æ˜µç§°ã€‚

ç¤ºä¾‹ï¼šä¹‹å‰ä»¥"å°æ˜"ç™»å½• â†’ æ€æ‰ App â†’ é‡æ–°æ‰“å¼€ â†’ è‡ªåŠ¨ä»¥"å°æ˜"èº«ä»½ç™»å½• â†’ å¦‚æœä¹‹å‰æœ‰è¿›è¡Œä¸­çš„èŠå¤©ä¸”åœ¨å®½é™æœŸå†…ï¼Œè‡ªåŠ¨æ¢å¤ã€‚

**US-7ï¼šä¸»åŠ¨ç¦»å¼€ä¸é€€å‡º**
> ä½œä¸ºä¸€ä¸ªèŠå¤©ä¸­çš„ç”¨æˆ·ï¼Œæˆ‘æƒ³è¦é€šè¿‡æ–­å¼€æŒ‰é’®ç»“æŸå½“å‰ä¼šè¯ï¼Œæˆ–é€šè¿‡è¿”å›æ‰‹åŠ¿é€€å‡ºç™»å½•çŠ¶æ€ï¼Œä»¥ä¾¿æ§åˆ¶è‡ªå·±çš„åœ¨çº¿çŠ¶æ€ã€‚

ç¤ºä¾‹ï¼šèŠå¤©ä¸­ â†’ ç‚¹å‡»"æ–­å¼€"æŒ‰é’® â†’ å›åˆ°ç©ºé—²çŠ¶æ€ â†’ å†æ¬¡è¿”å› â†’ é€€å‡ºç™»å½•ã€‚

## 6. æ ¸å¿ƒæ¶æ„ä¸æ¨¡å¼

### é«˜çº§æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 HarmonyOS NEXT App               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ArkUI    â”‚  â”‚ ä¸šåŠ¡é€»è¾‘  â”‚  â”‚ åŸç”Ÿèƒ½åŠ›å°è£…   â”‚  â”‚
â”‚  â”‚ è§†å›¾å±‚   â”‚â†â†’â”‚ çŠ¶æ€ç®¡ç†  â”‚â†â†’â”‚ Push/é€šçŸ¥/å­˜å‚¨ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                     â”‚                            â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚              â”‚ é€šä¿¡å±‚       â”‚                     â”‚
â”‚              â”‚ (å¾…è°ƒç ”ç¡®å®š) â”‚                     â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ WebSocket / Socket.io
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Server (Node.js)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Socket.ioâ”‚  â”‚Store â”‚  â”‚ Push å¤šé€šé“       â”‚   â”‚
â”‚  â”‚ äº‹ä»¶å¤„ç† â”‚  â”‚(å†…å­˜)â”‚  â”‚ FCM + Push Kit   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä»£ç ç»„ç»‡

```
smile-msg/                    # ç°æœ‰ monorepo
â”œâ”€â”€ server/                   # æœåŠ¡ç«¯ï¼ˆéœ€æ”¹åŠ¨ï¼šPush Kit é›†æˆï¼‰
â”œâ”€â”€ web/                      # Web å®¢æˆ·ç«¯ï¼ˆä¸å˜ï¼‰
â”œâ”€â”€ desktop/                  # Desktop å®¢æˆ·ç«¯ï¼ˆä¸å˜ï¼‰
â”œâ”€â”€ android/                  # Android å®¢æˆ·ç«¯ï¼ˆä¸å˜ï¼‰
â””â”€â”€ harmony/                  # ğŸ†• HarmonyOS NEXT åŸç”Ÿå®¢æˆ·ç«¯
    â”œâ”€â”€ entry/                # ä¸»æ¨¡å—
    â”‚   â””â”€â”€ src/main/
    â”‚       â”œâ”€â”€ ets/          # ArkTS æºç 
    â”‚       â”‚   â”œâ”€â”€ pages/    # é¡µé¢
    â”‚       â”‚   â”œâ”€â”€ common/   # é€šç”¨é€»è¾‘ï¼ˆé€šä¿¡ã€çŠ¶æ€ç®¡ç†ï¼‰
    â”‚       â”‚   â””â”€â”€ utils/    # å·¥å…·å‡½æ•°
    â”‚       â””â”€â”€ resources/    # èµ„æºæ–‡ä»¶
    â”œâ”€â”€ oh-package.json5      # ohpm ä¾èµ–é…ç½®
    â””â”€â”€ build-profile.json5   # æ„å»ºé…ç½®
```

> æ³¨æ„ï¼š`harmony/` ä¸çº³å…¥ pnpm-workspace.yamlï¼Œä½¿ç”¨ ohpm ç‹¬ç«‹ç®¡ç†ä¾èµ–ã€‚

### å…³é”®è®¾è®¡æ¨¡å¼

1. **çŠ¶æ€æœºé©±åŠ¨è§†å›¾**ï¼šä¸ Android ç‰ˆä¸€è‡´ï¼Œä½¿ç”¨ `phase: 'login' | 'idle' | 'chat'` çŠ¶æ€æœºæ§åˆ¶é¡µé¢åˆ‡æ¢
2. **å•ä¾‹é€šä¿¡å±‚**ï¼šé€šä¿¡å®ä¾‹å…¨å±€å•ä¾‹ï¼Œæ‰€æœ‰é¡µé¢å…±äº«åŒä¸€è¿æ¥
3. **å“åº”å¼çŠ¶æ€**ï¼šä½¿ç”¨ ArkUI çš„ `@State` / `@Observed` å®ç°çŠ¶æ€é©±åŠ¨ UI æ›´æ–°
4. **äº‹ä»¶é©±åŠ¨é€šä¿¡**ï¼šæœåŠ¡ç«¯äº‹ä»¶ï¼ˆ`new_message`ã€`conversation_created`ã€`peer_offline` ç­‰ï¼‰æ˜ å°„ä¸ºçŠ¶æ€æ›´æ–°

### é€šä¿¡å±‚æ–¹æ¡ˆï¼ˆå¾…è°ƒç ”ï¼‰

è¿™æ˜¯æœ¬é¡¹ç›®æœ€å…³é”®çš„æ¶æ„å†³ç­–ç‚¹ã€‚æœåŠ¡ç«¯ä½¿ç”¨ Socket.io åè®®ï¼Œé¸¿è’™åŸç”Ÿ ArkTS æ²¡æœ‰å®˜æ–¹ Socket.io å®¢æˆ·ç«¯åº“ã€‚å€™é€‰æ–¹æ¡ˆï¼š

| æ–¹æ¡ˆ | æè¿° | ä¼˜åŠ¿ | é£é™© |
|------|------|------|------|
| A. æœåŠ¡ç«¯åŠ åŸç”Ÿ WS ç«¯ç‚¹ | æœåŠ¡ç«¯æ–°å¢åŸç”Ÿ WebSocket ç«¯ç‚¹ï¼Œé¸¿è’™ç”¨ `@kit.NetworkKit` ç›´è¿ | æœ€ç¨³å¦¥ï¼Œä¸ä¾èµ–ä¸‰æ–¹åº“ | æœåŠ¡ç«¯éœ€ç»´æŠ¤ä¸¤å¥—é€šä¿¡åè®® |
| B. ohpm ç¤¾åŒº Socket.io åº“ | åœ¨ ohpm ä¸­å¿ƒä»“å¯»æ‰¾ç¤¾åŒºå®ç°çš„ Socket.io å®¢æˆ·ç«¯ | æœ€å°æ”¹åŠ¨ | åº“è´¨é‡å’Œç»´æŠ¤ä¸ç¡®å®š |
| C. è‡ªå®ç° Socket.io åè®® | åŸºäºé¸¿è’™ WebSocket API å°è£… Socket.io åè®®å±‚ | å®Œå…¨å¯æ§ | å·¥ä½œé‡å¤§ï¼Œéœ€å®ç°æ¡æ‰‹/å¿ƒè·³/æ¶ˆæ¯å¸§ |

**å†³ç­–æ—¶æœº**ï¼šåœ¨è®¡åˆ’é˜¶æ®µï¼ˆ`/rpiv_loop:plan-feature`ï¼‰è¿›è¡ŒæŠ€æœ¯é¢„ç ”åç¡®å®šã€‚

## 7. åŠŸèƒ½è§„æ ¼

### 7.1 ç™»å½•æ¨¡å—

| é¡¹ç›® | è§„æ ¼ |
|------|------|
| UUID ç”Ÿæˆ | å®¢æˆ·ç«¯æœ¬åœ°ç”Ÿæˆ UUID v4 |
| æ˜µç§°è§„åˆ™ | 1-20 å­—ç¬¦ï¼Œä¸å¯ä¸ºç©º |
| ç™»å½•åè®® | `login` äº‹ä»¶ï¼Œå‚æ•° `{uuid, nickname}`ï¼Œå›è°ƒ `{success, restored?, conversationId?, target?}` |
| æŒä¹…åŒ– | ç™»å½•æˆåŠŸåæœ¬åœ°ä¿å­˜ UUID + æ˜µç§° |
| ä¼šè¯æ¢å¤ | å¯åŠ¨æ—¶æ£€æŸ¥æœ¬åœ°å­˜å‚¨ï¼Œæœ‰åˆ™è‡ªåŠ¨ç™»å½• |
| è¸¢å‡ºæœºåˆ¶ | åŒä¸€ UUID æ–°ç™»å½•ä¼šè¸¢æ‰æ—§è¿æ¥ï¼ˆ`force_disconnect` äº‹ä»¶ï¼‰ |

### 7.2 èŠå¤©æ¨¡å—

| é¡¹ç›® | è§„æ ¼ |
|------|------|
| å‘èµ·èŠå¤© | `create_private_chat` äº‹ä»¶ï¼Œå‚æ•° `{targetNickname}` |
| æ¥æ”¶é‚€è¯· | ç›‘å¬ `conversation_created` äº‹ä»¶ |
| å‘é€æ¶ˆæ¯ | `send_message` äº‹ä»¶ï¼Œå‚æ•° `{conversationId, content}` |
| æ¥æ”¶æ¶ˆæ¯ | ç›‘å¬ `new_message` äº‹ä»¶ |
| ç¦»å¼€ä¼šè¯ | `leave_conversation` äº‹ä»¶ï¼Œå‚æ•° `{conversationId}` |
| å¯¹æ–¹ç¦»çº¿ | ç›‘å¬ `peer_offline` äº‹ä»¶ï¼Œæ˜¾ç¤ºç³»ç»Ÿæ¶ˆæ¯ |
| æ¶ˆæ¯ä¸Šé™ | å®¢æˆ·ç«¯æœ€å¤šä¿æŒ 200 æ¡æ¶ˆæ¯ï¼ˆä¸ Android ç‰ˆä¸€è‡´ï¼‰ |
| æ¶ˆæ¯ç±»å‹ | æ–‡æœ¬æ¶ˆæ¯ + ç³»ç»Ÿæ¶ˆæ¯ |

### 7.3 æ¨é€æ¨¡å—

| é¡¹ç›® | è§„æ ¼ |
|------|------|
| Push Kit Token | ç™»å½•æˆåŠŸåè·å– Push Token |
| Token ä¸ŠæŠ¥ | `register_push_token` äº‹ä»¶ï¼Œå‚æ•° `{token}` |
| Token åˆ·æ–° | ç›‘å¬ Token å˜åŒ–äº‹ä»¶ï¼Œè‡ªåŠ¨é‡æ–°ä¸ŠæŠ¥ |
| æ¨é€å†…å®¹ | æ ‡é¢˜ï¼š`{senderNickname} å‘æ¥æ¶ˆæ¯`ï¼Œæ­£æ–‡ï¼šæ¶ˆæ¯å†…å®¹ï¼ˆæˆªæ–­ 100 å­—ç¬¦ï¼‰ |
| å‰å°è¡Œä¸º | ä¸å±•ç¤ºæ¨é€é€šçŸ¥ï¼Œä»…æŒ¯åŠ¨åé¦ˆ |
| åå°è¡Œä¸º | ç³»ç»Ÿæ¨é€é€šçŸ¥å±•ç¤º |

### 7.4 è¿æ¥ç®¡ç†æ¨¡å—

| é¡¹ç›® | è§„æ ¼ |
|------|------|
| ä¼ è¾“åè®® | WebSocketï¼ˆå¾…è°ƒç ”ç¡®å®šå…·ä½“æ–¹æ¡ˆï¼‰ |
| è‡ªåŠ¨é‡è¿ | å¯ç”¨ï¼Œæ— é™é‡è¯•ï¼ŒæŒ‡æ•°é€€é¿ï¼ˆ1s â†’ 5s maxï¼‰ |
| æ–­çº¿æ£€æµ‹ | ä¾èµ–é€šä¿¡å±‚å®ç° |
| é‡è¿åè¡Œä¸º | è‡ªåŠ¨é‡æ–°ç™»å½• + ä¼šè¯æ¢å¤ + é‡æ–°æ³¨å†Œ Push Token |
| å‰åå°ä¸ŠæŠ¥ | `app_state` äº‹ä»¶ï¼Œå‚æ•° `{inBackground: boolean}` |

### 7.5 é”™è¯¯æç¤º

| åœºæ™¯ | æç¤ºå†…å®¹ |
|------|---------|
| æ˜µç§°å·²è¢«ä½¿ç”¨ | "æ˜µç§°å·²è¢«ä½¿ç”¨" |
| å¯¹æ–¹ä¸åœ¨çº¿ | "è¯¥ç”¨æˆ·ä¸åœ¨çº¿" |
| å¯¹æ–¹æ­£å¿™ | "å¯¹æ–¹æ­£å¿™" |
| ä¸èƒ½å’Œè‡ªå·±èŠå¤© | "ä¸èƒ½å’Œè‡ªå·±èŠå¤©" |
| è‡ªå·±å·²åœ¨èŠå¤©ä¸­ | "ä½ å·²åœ¨èŠå¤©ä¸­" |

## 8. æŠ€æœ¯æ ˆ

### å®¢æˆ·ç«¯

| ç±»åˆ« | æŠ€æœ¯ | è¯´æ˜ |
|------|------|------|
| å¼€å‘è¯­è¨€ | ArkTS | HarmonyOS NEXT åŸç”Ÿå¼€å‘è¯­è¨€ |
| UI æ¡†æ¶ | ArkUI | å£°æ˜å¼ UI æ¡†æ¶ |
| IDE | DevEco Studio | åä¸ºå®˜æ–¹ IDE |
| ç›®æ ‡å¹³å° | HarmonyOS NEXT | çº¯é¸¿è’™ç³»ç»Ÿï¼ˆéå…¼å®¹å®‰å“ç‰ˆï¼‰ |
| API ç‰ˆæœ¬ | å¾…è®¡åˆ’é˜¶æ®µç¡®å®š | éœ€è°ƒç ”æœ€ä½å…¼å®¹ç‰ˆæœ¬ |
| åŒ…ç®¡ç† | ohpm | OpenHarmony Package Manager |
| é€šä¿¡ | å¾…è°ƒç ” | `@kit.NetworkKit` WebSocket æˆ– ohpm ä¸‰æ–¹åº“ |
| æ¨é€ | Push Kit | åä¸ºåŸç”Ÿæ¨é€æœåŠ¡ |
| æœ¬åœ°å­˜å‚¨ | å¾…è°ƒç ” | `@ohos.data.preferences` æˆ–ç­‰æ•ˆ API |
| æŒ¯åŠ¨ | å¾…è°ƒç ” | é¸¿è’™æŒ¯åŠ¨ API |
| é€šçŸ¥ | Notification Kit | æœ¬åœ°é€šçŸ¥ï¼ˆå‰å°è¡¥å……ç”¨ï¼‰ |

### æœåŠ¡ç«¯ï¼ˆæ”¹åŠ¨éƒ¨åˆ†ï¼‰

| ç±»åˆ« | æŠ€æœ¯ | è¯´æ˜ |
|------|------|------|
| Push Kit SDK | REST API | OAuth 2.0 é‰´æƒ + HTTPS æ¨é€ |
| å‚è€ƒå®ç° | [hms-push-serverdemo-nodejs](https://github.com/HMS-Core/hms-push-serverdemo-nodejs) | åä¸ºå®˜æ–¹ Node.js ç¤ºä¾‹ |
| é‰´æƒæ–¹å¼ | OAuth 2.0 client_credentials | App ID + App Secret è·å– Access Token |
| ç°æœ‰ä¾èµ– | firebase-admin | ä¿æŒä¸å˜ï¼ŒFCM æ¨é€ç»§ç»­ä½¿ç”¨ |

## 9. å®‰å…¨ä¸é…ç½®

### èº«ä»½éªŒè¯

- æ— è´¦å·ä½“ç³»ï¼Œä½¿ç”¨å®¢æˆ·ç«¯ç”Ÿæˆçš„ UUID ä½œä¸ºèº«ä»½æ ‡è¯†
- Socket è¿æ¥æ— é¢å¤–é‰´æƒï¼ˆä¸ç°æœ‰å„ç«¯ä¸€è‡´ï¼‰

### é…ç½®ç®¡ç†

**å®¢æˆ·ç«¯ç¯å¢ƒé…ç½®**

| ç¯å¢ƒ | Server URL |
|------|-----------|
| å¼€å‘ | `http://localhost:3000` |
| ç”Ÿäº§ | `https://smile-msg.zeabur.app` |

**æœåŠ¡ç«¯æ–°å¢ç¯å¢ƒå˜é‡**

| å˜é‡ | è¯´æ˜ |
|------|------|
| `HUAWEI_APP_ID` | åä¸º AGC åº”ç”¨ App ID |
| `HUAWEI_APP_SECRET` | åä¸º AGC åº”ç”¨ App Secret |
| `HUAWEI_PUSH_URL` | Push Kit REST API åœ°å€ |
| `HUAWEI_AUTH_URL` | OAuth 2.0 Token è·å–åœ°å€ |

### å®‰å…¨èŒƒå›´

- **èŒƒå›´å†…**ï¼šä¼ è¾“å±‚åŠ å¯†ï¼ˆWSS/HTTPSï¼‰ã€æ¨é€å†…å®¹æˆªæ–­ï¼ˆ100 å­—ç¬¦ï¼‰ã€Push Token æ ¡éªŒï¼ˆé•¿åº¦ â‰¤ 500ï¼‰
- **èŒƒå›´å¤–**ï¼šç«¯åˆ°ç«¯åŠ å¯†ã€æ¶ˆæ¯å†…å®¹åŠ å¯†ã€ç”¨æˆ·é‰´æƒå¼ºåŒ–

### éƒ¨ç½²

- æœåŠ¡ç«¯ï¼šç°æœ‰ Zeabur éƒ¨ç½²ï¼Œæ–°å¢ Push Kit ç›¸å…³ç¯å¢ƒå˜é‡
- å®¢æˆ·ç«¯ï¼šAppGallery ä¸Šæ¶ï¼Œéœ€å®Œæˆåä¸ºå¼€å‘è€…è´¦å·æ³¨å†Œã€åº”ç”¨ç­¾åç­‰æµç¨‹

## 10. API è§„æ ¼

### Socket.io äº‹ä»¶æ¥å£ï¼ˆå®¢æˆ·ç«¯ â†” æœåŠ¡ç«¯ï¼‰

æ‰€æœ‰äº‹ä»¶ä¸ç°æœ‰æ¥å£å®Œå…¨ä¸€è‡´ï¼Œé¸¿è’™å®¢æˆ·ç«¯éœ€å®ç°ä»¥ä¸‹äº‹ä»¶ï¼š

#### å®¢æˆ·ç«¯ â†’ æœåŠ¡ç«¯

```
login({ uuid: string, nickname: string }, callback)
  â†’ { success: true, restored?: boolean, conversationId?: string, target?: { uuid, nickname } }
  â†’ { success: false, error: string }

create_private_chat({ targetNickname: string }, callback)
  â†’ { success: true, conversationId: string, target: { uuid, nickname } }
  â†’ { success: false, error: string }

send_message({ conversationId: string, content: string })

leave_conversation({ conversationId: string }, callback)
  â†’ { success: boolean }

register_push_token({ token: string })

app_state({ inBackground: boolean })
```

#### æœåŠ¡ç«¯ â†’ å®¢æˆ·ç«¯

```
new_message({ conversationId: string, message: { id, senderUuid, senderNickname, content, timestamp, type } })

conversation_created({ conversationId: string, target: { uuid, nickname } })

peer_offline({ conversationId: string })

force_disconnect({ reason: string })
```

### Push Kit æœåŠ¡ç«¯ REST APIï¼ˆæ–°å¢ï¼‰

```
POST https://push-api.cloud.huawei.com/v2/{appId}/messages:send
Authorization: Bearer {accessToken}
Content-Type: application/json

{
  "message": {
    "token": ["{pushToken}"],
    "notification": {
      "title": "{senderNickname} å‘æ¥æ¶ˆæ¯",
      "body": "{truncatedContent}"
    },
    "data": "{\"type\":\"new_message\",\"senderNickname\":\"...\",\"conversationId\":\"...\"}",
    "android": {
      "notification": {
        "click_action": { "type": 1 }
      }
    }
  }
}
```

Token è·å–ï¼š

```
POST https://oauth-login.cloud.huawei.com/oauth2/v3/token
Content-Type: application/x-www-form-urlencoded

grant_type=client_credentials&client_id={appId}&client_secret={appSecret}
```

## 11. æˆåŠŸæ ‡å‡†

### MVP æˆåŠŸå®šä¹‰

åœ¨ HarmonyOS NEXT è®¾å¤‡ä¸Šï¼Œç”¨æˆ·èƒ½å¤Ÿå®Œæˆä»ç™»å½•åˆ°èŠå¤©åˆ°æ¥æ”¶æ¨é€é€šçŸ¥çš„å®Œæ•´é—­ç¯ï¼Œä½“éªŒä¸ Android ç‰ˆåŠŸèƒ½å¯¹ç­‰ã€‚

### åŠŸèƒ½è¦æ±‚

- âœ… æ˜µç§°ç™»å½•æˆåŠŸç‡ 100%ï¼ˆç½‘ç»œæ­£å¸¸æ—¶ï¼‰
- âœ… æ¶ˆæ¯æ”¶å‘å»¶è¿Ÿ < 500msï¼ˆå‰å°ï¼Œå±€åŸŸç½‘ç¯å¢ƒï¼‰
- âœ… Push Kit æ¨é€åˆ°è¾¾ç‡ç¬¦åˆåä¸º SLA
- âœ… æ–­çº¿é‡è¿æˆåŠŸç‡ > 95%ï¼ˆç½‘ç»œæ¢å¤å 10 ç§’å†…ï¼‰
- âœ… ä¼šè¯æ¢å¤åœ¨ 30 åˆ†é’Ÿå®½é™æœŸå†… 100% å¯ç”¨
- âœ… æ‰€æœ‰ Android ç‰ˆæ”¯æŒçš„é”™è¯¯æç¤ºåœ¨é¸¿è’™ç‰ˆå‡æœ‰å¯¹åº”å®ç°

### è´¨é‡æŒ‡æ ‡

- åº”ç”¨å¯åŠ¨åˆ°ç™»å½•é¡µå¯äº¤äº’ < 2 ç§’
- æ— å†…å­˜æ³„æ¼ï¼ˆé•¿æ—¶é—´èŠå¤©åœºæ™¯ï¼‰
- æ—  ANRï¼ˆApplication Not Respondingï¼‰

### ç”¨æˆ·ä½“éªŒç›®æ ‡

- ç¬¦åˆ HarmonyOS Design è§†è§‰è§„èŒƒ
- è¿”å›æ‰‹åŠ¿è¡Œä¸ºç¬¦åˆé¸¿è’™ç³»ç»Ÿé¢„æœŸ
- æ¨é€é€šçŸ¥ç‚¹å‡»å < 1 ç§’è¿›å…¥åº”ç”¨

## 12. å®æ–½é˜¶æ®µ

### é˜¶æ®µ 0ï¼šæŠ€æœ¯é¢„ç ”

**ç›®æ ‡**ï¼šéªŒè¯å…³é”®æŠ€æœ¯å¯è¡Œæ€§ï¼Œç¡®å®šé€šä¿¡æ–¹æ¡ˆ

- âœ… è°ƒç ”é¸¿è’™ WebSocket API ä¸ Socket.io åè®®å…¼å®¹æ€§
- âœ… è°ƒç ” ohpm ä¸Š Socket.io ç›¸å…³ç¤¾åŒºåº“
- âœ… ç¡®å®šé€šä¿¡å±‚æ–¹æ¡ˆï¼ˆä¸‰é€‰ä¸€ï¼‰
- âœ… éªŒè¯ Push Kit å®¢æˆ·ç«¯ Token è·å–æµç¨‹
- âœ… ç¡®å®šç›®æ ‡ API ç‰ˆæœ¬å’Œæœ€ä½å…¼å®¹ç‰ˆæœ¬
- âœ… ç¡®å®šæœ¬åœ°å­˜å‚¨ã€æŒ¯åŠ¨ã€é€šçŸ¥ç­‰åŸç”Ÿ API é€‰å‹

**éªŒè¯æ ‡å‡†**ï¼šè¾“å‡ºæŠ€æœ¯å†³ç­–æ–‡æ¡£ï¼Œæ‰€æœ‰å¾…å®šé¡¹å‡å·²ç¡®å®šã€‚

### é˜¶æ®µ 1ï¼šåŸºç¡€é€šä¿¡ + ç™»å½•

**ç›®æ ‡**ï¼šè·‘é€šé¸¿è’™å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯çš„é€šä¿¡é“¾è·¯

- âœ… æ­å»º harmony/ é¡¹ç›®éª¨æ¶ï¼ˆDevEco Studio å·¥ç¨‹ï¼‰
- âœ… å®ç°é€šä¿¡å±‚ï¼ˆåŸºäºé˜¶æ®µ 0 çš„æŠ€æœ¯å†³ç­–ï¼‰
- âœ… å®ç° LoginView é¡µé¢ï¼ˆArkUIï¼‰
- âœ… å®ç°ç™»å½•æµç¨‹ï¼ˆUUID ç”Ÿæˆã€login äº‹ä»¶ã€é”™è¯¯å¤„ç†ï¼‰
- âœ… å®ç°æœ¬åœ°æŒä¹…åŒ–ï¼ˆUUID + æ˜µç§°ï¼‰
- âœ… å®ç°å¯åŠ¨æ—¶è‡ªåŠ¨æ¢å¤ä¼šè¯
- âœ… æœåŠ¡ç«¯ `parsePlatform()` æ–°å¢ `harmony` è¯†åˆ«

**éªŒè¯æ ‡å‡†**ï¼šé¸¿è’™è®¾å¤‡ä¸Šèƒ½æˆåŠŸç™»å½•ï¼ŒæœåŠ¡ç«¯è¯†åˆ«ä¸º harmony å¹³å°ï¼Œé‡å¯ App åè‡ªåŠ¨æ¢å¤ç™»å½•ã€‚

### é˜¶æ®µ 2ï¼šèŠå¤©åŠŸèƒ½

**ç›®æ ‡**ï¼šå®ç°å®Œæ•´çš„èŠå¤©äº¤äº’

- âœ… å®ç° ChatView é¡µé¢ï¼ˆidle æ€ + chat æ€ï¼‰
- âœ… å®ç°å‘èµ·ç§èŠã€æ¥æ”¶é‚€è¯·
- âœ… å®ç°æ¶ˆæ¯æ”¶å‘å’Œæ˜¾ç¤ºï¼ˆæ–‡æœ¬æ¶ˆæ¯ + ç³»ç»Ÿæ¶ˆæ¯ï¼‰
- âœ… å®ç°ç¦»å¼€ä¼šè¯
- âœ… å®ç°å¯¹æ–¹ç¦»çº¿æç¤º
- âœ… å®ç°æ–­çº¿é‡è¿ + ä¼šè¯æ¢å¤
- âœ… å®ç°å‰å°æŒ¯åŠ¨åé¦ˆ
- âœ… å®ç°è¿”å›æ‰‹åŠ¿è¡Œä¸º
- âœ… å®ç°å‰åå°çŠ¶æ€ä¸ŠæŠ¥ï¼ˆ`app_state`ï¼‰

**éªŒè¯æ ‡å‡†**ï¼šä¸¤å°é¸¿è’™è®¾å¤‡ï¼ˆæˆ–é¸¿è’™ + å…¶ä»–å¹³å°ï¼‰ä¹‹é—´èƒ½å®Œæˆå®Œæ•´çš„èŠå¤©æµç¨‹ï¼Œæ–­çº¿æ¢å¤æ­£å¸¸ã€‚

### é˜¶æ®µ 3ï¼šPush Kit é›†æˆ + ä¸Šæ¶

**ç›®æ ‡**ï¼šå®ç°æ¨é€é€šçŸ¥ï¼Œå®Œæˆ AppGallery ä¸Šæ¶

- âœ… æœåŠ¡ç«¯é›†æˆ Push Kitï¼ˆOAuth 2.0 + REST APIï¼‰
- âœ… æœåŠ¡ç«¯ push.js é‡æ„ä¸ºå¤šé€šé“ï¼ˆFCM + Push Kitï¼‰
- âœ… æœåŠ¡ç«¯æŒ‰ platform è·¯ç”±æ¨é€ï¼ˆandroidâ†’FCM, harmonyâ†’Push Kitï¼‰
- âœ… å®¢æˆ·ç«¯è·å– Push Token å¹¶ä¸ŠæŠ¥
- âœ… å®¢æˆ·ç«¯ç›‘å¬ Token åˆ·æ–°å¹¶é‡æ–°ä¸ŠæŠ¥
- âœ… åå°æ¨é€é€šçŸ¥å±•ç¤º
- âœ… é€šçŸ¥ç‚¹å‡»æ‰“å¼€åº”ç”¨è·³è½¬é€»è¾‘
- âœ… é€šçŸ¥æƒé™è¯·æ±‚
- âœ… åº”ç”¨ç­¾åã€ä¸Šæ¶ AppGallery

**éªŒè¯æ ‡å‡†**ï¼šApp åœ¨åå°æ—¶èƒ½é€šè¿‡ Push Kit æ”¶åˆ°æ¨é€é€šçŸ¥ï¼Œç‚¹å‡»é€šçŸ¥èƒ½è¿›å…¥åº”ç”¨ã€‚AppGallery å®¡æ ¸é€šè¿‡ã€‚

## 13. æœªæ¥è€ƒè™‘

### MVP åå¢å¼º

- **é¸¿è’™å¡ç‰‡æœåŠ¡ï¼ˆWidgetï¼‰**ï¼šåœ¨æ¡Œé¢å¡ç‰‡ä¸Šæ˜¾ç¤ºæœªè¯»æ¶ˆæ¯æˆ–åœ¨çº¿çŠ¶æ€
- **åˆ†äº«åŠŸèƒ½**ï¼šé€šè¿‡é¸¿è’™ç³»ç»Ÿåˆ†äº«é¢æ¿é‚€è¯·å¥½å‹
- **å¤šç«¯ååŒ**ï¼šåˆ©ç”¨é¸¿è’™åˆ†å¸ƒå¼èƒ½åŠ›ï¼Œæ‰‹æœº/å¹³æ¿æ— ç¼æµè½¬èŠå¤©
- **UI åŠ¨æ•ˆæ‰“ç£¨**ï¼šæ¶ˆæ¯å‘é€/æ¥æ”¶åŠ¨ç”»ã€é¡µé¢åˆ‡æ¢è¿‡æ¸¡åŠ¨æ•ˆ

### é›†æˆæœºä¼š

- **é¸¿è’™é€šçŸ¥åˆ†ç±»**ï¼šåˆ©ç”¨ Notification Kit çš„åˆ†ç±»èƒ½åŠ›ä¼˜åŒ–é€šçŸ¥ä½“éªŒ
- **æ„å›¾æ¡†æ¶ï¼ˆIntents Kitï¼‰**ï¼šæ”¯æŒç³»ç»Ÿçº§å¿«æ·æ“ä½œ
- **åä¸ºè´¦å·ç™»å½•**ï¼šå¯é€‰çš„åä¸ºè´¦å·ç»‘å®šï¼Œæ›¿ä»£çº¯æ˜µç§°ç™»å½•

### é«˜çº§åŠŸèƒ½ï¼ˆè¿œæœŸï¼‰

- ç¾¤èŠ
- å¤šåª’ä½“æ¶ˆæ¯ï¼ˆå›¾ç‰‡ã€è¯­éŸ³ï¼‰
- ç«¯åˆ°ç«¯åŠ å¯†
- æ¶ˆæ¯å·²è¯»å›æ‰§

## 14. é£é™©ä¸ç¼“è§£æªæ–½

| é£é™© | å½±å“ | æ¦‚ç‡ | ç¼“è§£æªæ–½ |
|------|------|------|---------|
| **Socket.io å…¼å®¹æ€§**ï¼šé¸¿è’™æ— åŸç”Ÿ Socket.io å®¢æˆ·ç«¯ï¼Œé€šä¿¡æ–¹æ¡ˆä¸ç¡®å®š | é«˜ | é«˜ | é˜¶æ®µ 0 ä¼˜å…ˆè°ƒç ”ï¼Œå‡†å¤‡ä¸‰ä¸ªå¤‡é€‰æ–¹æ¡ˆï¼Œæœ€åæƒ…å†µæœåŠ¡ç«¯åŠ åŸç”Ÿ WS ç«¯ç‚¹ |
| **Push Kit æœåŠ¡ç«¯é›†æˆå¤æ‚åº¦**ï¼šOAuth é‰´æƒã€Token ç®¡ç†ã€REST API è°ƒç”¨ä¸ FCM å·®å¼‚å¤§ | ä¸­ | ä¸­ | å‚è€ƒåä¸ºå®˜æ–¹ Node.js ç¤ºä¾‹ä»£ç ï¼Œç‹¬ç«‹æ¨¡å—å°è£…ï¼Œä¸å½±å“ç°æœ‰ FCM é€»è¾‘ |
| **AppGallery å®¡æ ¸**ï¼šä¸Šæ¶å®¡æ ¸æ ‡å‡†ä¸ç¡®å®šï¼Œå¯èƒ½éœ€è¦å¤šæ¬¡æäº¤ | ä¸­ | ä¸­ | æå‰äº†è§£å®¡æ ¸æ ‡å‡†ï¼Œé¢„ç•™å®¡æ ¸è¿­ä»£æ—¶é—´ |
| **ArkTS ç”Ÿæ€æˆç†Ÿåº¦**ï¼šé¸¿è’™ NEXT ç”Ÿæ€ä»åœ¨å‘å±•ä¸­ï¼Œå¯èƒ½é‡åˆ°æ–‡æ¡£ä¸å®Œå–„æˆ– API å˜æ›´ | ä¸­ | ä¸­ | å…³æ³¨åä¸ºå¼€å‘è€…ç¤¾åŒºå’Œæ›´æ–°æ—¥å¿—ï¼Œé€‰æ‹©ç¨³å®š API ç‰ˆæœ¬ |
| **æµ‹è¯•è®¾å¤‡æœ‰é™**ï¼šHarmonyOS NEXT è®¾å¤‡ç§ç±»æœ‰é™ï¼ŒçœŸæœºæµ‹è¯•è¦†ç›–ä¸è¶³ | ä½ | ä¸­ | ä¼˜å…ˆä½¿ç”¨ DevEco Studio æ¨¡æ‹Ÿå™¨ + è‡³å°‘ä¸€å°çœŸæœºéªŒè¯ |

## 15. é™„å½•

### ç›¸å…³æ–‡æ¡£

- åä¸º Push Kit æ–‡æ¡£ï¼šhttps://developer.huawei.com/consumer/cn/hms/huawei-pushkit
- Push Kit æœåŠ¡ç«¯ Node.js ç¤ºä¾‹ï¼šhttps://github.com/HMS-Core/hms-push-serverdemo-nodejs
- HarmonyOS WebSocket å¼€å‘æŒ‡å—ï¼šhttps://developer.huawei.com/consumer/cn/doc/harmonyos-guides/websocket-connection-0000001477981069
- ohpm ä¸­å¿ƒä»“ï¼šhttps://ohpm.openharmony.cn/
- Push Kit Node.js æ•™ç¨‹ï¼šhttps://bensonthew.medium.com/sending-push-notifications-with-huawei-push-kit-v2-api-using-node-js-a-comprehensive-guide-1a5aa74e281a

### ç°æœ‰æœåŠ¡ç«¯å…³é”®æ–‡ä»¶

| æ–‡ä»¶ | è·¯å¾„ | æ”¹åŠ¨è¯´æ˜ |
|------|------|---------|
| äº‹ä»¶å¤„ç† | `server/src/handlers/chat.js` | `parsePlatform()` æ–°å¢ harmony è¯†åˆ« |
| æ¨é€æ¨¡å— | `server/src/push.js` | é‡æ„ä¸º FCM + Push Kit åŒé€šé“ |
| æ•°æ®å­˜å‚¨ | `server/src/store.js` | æ— éœ€æ”¹åŠ¨ï¼Œ`platform` å­—æ®µå·²å­˜åœ¨ |
| ä¸»å…¥å£ | `server/src/index.js` | Push Kit åˆå§‹åŒ– |

### é¡¹ç›®ç»“æ„

```
smile-msg/
â”œâ”€â”€ server/          # æœåŠ¡ç«¯ï¼ˆæ”¹åŠ¨ï¼šPush Kit é›†æˆï¼‰
â”œâ”€â”€ web/             # Web å®¢æˆ·ç«¯ï¼ˆä¸å˜ï¼‰
â”œâ”€â”€ desktop/         # Desktop å®¢æˆ·ç«¯ï¼ˆä¸å˜ï¼‰
â”œâ”€â”€ android/         # Android å®¢æˆ·ç«¯ï¼ˆä¸å˜ï¼‰
â”œâ”€â”€ harmony/         # ğŸ†• HarmonyOS NEXT åŸç”Ÿå®¢æˆ·ç«¯
â””â”€â”€ pnpm-workspace.yaml  # ä¸åŒ…å« harmony/
```
